services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "55432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - ./docker/postgres-init:/docker-entrypoint-initdb.d:ro

  backend:
    build: ./backend
    environment:
      DB_URL: postgres://postgres:postgres@postgres:5432/usdt_trading_dev
      TEST_DB_URL: postgres://postgres:postgres@postgres:5432/usdt_trading_test
      JWT_SECRET: compose-secret-0123456789-compose-secret-0123456789
      TELEGRAM_BOT_TOKEN: ""
      TELEGRAM_WEBHOOK_SECRET: compose-webhook-secret
      AUTO_SETTLEMENT_ENABLED: "true"
      PROMETHEUS_METRICS_KEY: compose-metrics
      LOG_LEVEL: info
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "9090:9090"

  frontend:
    build: ./frontend
    depends_on:
      - backend
    ports:
      - "4173:80"
