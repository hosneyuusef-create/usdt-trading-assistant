## Global Engineering Playbook — Release v1.1

> این سند باید **در ابتدای هر مرحله** و **پس از تکمیل هر مرحله** مطالعه و رعایت شود. هر مرحله بدون تأیید تمامی بندهای این Playbook «به پایان نرسیده» محسوب می‌شود.

### 1. مأموریت و اهمیت
- پیش از شروع پروژه، مخزن Git مطابق docs/git_setup_guide.md آماده و برچسب baseline ایجاد شود.
- این پروژه در سطح استاندارد سازمان‌های پیشرو (Google-level) اجرا می‌شود؛ خروجی باید در آزمون‌های سختگیرانهٔ امنیت، قابلیت نگهداری و قابلیت بازیابی سربلند باشد.
- هیچ مصالحه‌ای روی کیفیت، دقت یا ردیابی پذیرفته نیست. هر Artefact باید ممیزی‌پذیر، تکرارپذیر و مستند باشد.

### 2. اجرای مرحله
1. **مرور کامل ورودی‌ها:** قبل از آغاز، تمام Artefactهای مرتبط (RTM، اسناد مرحله، فرضیات باز) را مطالعه کن. بدون مرور کامل، شروع مرحله ممنوع است.
2. **هدف شفاف:** هدف مرحله و خروجی‌های ملموس را به‌صورت دقیق برای خود تکرار و یادداشت کن. اگر ابهام داری، قبل از اجرا در بخش Assumptions ثبت کن و پاسخ بگیر.
3. **عدم فرض جدید بدون تحلیل:**  
   - ایجاد فرض فقط بعد از بررسی اثر آن روی معماری، API، داده، تست و استقرار مجاز است.  
   - فرض جدید باید در بخش Assumptions مرحله ثبت شود (شرح، دلیل، اثر، مسئول، وضعیت) و ردیف متناظر در `artefacts/assumptions_log.md` ایجاد یا به‌روز شود.  
   - تا قبل از پاسخ/تأیید، مرحله بعدی آغاز نمی‌شود.
4. **همسوسازی با Playbook:** اجرای هر گام باید با استانداردهای این سند و `marahel.txt` هم‌راستا باشد. هر مغایرت را ثبت و برای اصلاح اقدام کن.
5. **کنترل نسخه و Commit:**  
   - قبل از هر تغییر کد/اسکریپت، یک شاخه‌ی کاری جدید با نام استاندارد `feature/<stage-id>/<short-description>` ایجاد کن.  
   - Commitها باید کوچک، هدفمند و دارای پیام واضح (فرمت پیشنهادی: `<Stage-ID>: <شرح>` مثل `M13: implement rfq special conditions validation`) باشند.  
   - اگر تغییری نادرست بود، فایل‌ها باید به وضعیت قبل (از طریق Git) برگردانده و ثبت شود؛ هر فایل تغییر یافته‌ی ناخواسته باید Revert و گزارش شود.

### 3. حین توسعه
- **ردیابی Artefact:** هر خروجی را در مسیر تعیین‌شده تولید و ثبت کن؛ مسیر و نسخه را در لاگ مرحله بنویس.
- **کنترل تغییر:** هر تغییری باید با ثبت تاریخ/نام مسئول و لینک Commit یا Artefact در مستندات مرحله همراه باشد.
- **عدم اتکا به حافظه:** هر تصمیم یا تغییر باید فوراً مستند شود؛ هیچ تصمیم شفاهی/ضمنی پذیرفته نیست.
- **بررسی اثرات:** هنگام تغییر، اثر آن بر مراحل قبلی/بعدی و سرویس‌های وابسته را تحلیل و در صورت نیاز اصلاح کن.

### 4. پایان مرحله
1. **جمع‌آوری شواهد:** قبل از اعلام پایان، همه خروجی‌های ملموس، گزارش‌ها، ویدئوها و لاگ‌ها را در مسیرهای مشخص قرار بده.
2. **تست کامل:** تست‌های واحد، یکپارچه، E2E یا Benchهای موردنیاز مرحله باید اجرا شوند؛ خروجی تست‌ها ذخیره و لینک آن ثبت شود. بدون شواهد تست مرحله پایان نمی‌یابد.
3. **مرور Assumptions:** وضعیت تمام فرضیات باز به‌روزرسانی شود (Closed/Resolved/Rejected). اگر فرضی پاسخ نگرفته، مرحله بعدی مجاز نیست.
4. **Cross-check:** خروجی را با معیارهای پذیرش و KPIهای مرحله تطبیق بده؛ اگر انحراف وجود دارد، مستند و اصلاح کن.
5. **ثبت نتیجه:** گزارش مختصر شامل خلاصه خروجی، لینک Artefact، وضعیت تست‌ها و وضعیت فرضیات در انتهای مرحله ثبت شود؛ فرم `artefacts/stage_completion_checklist.md` تکمیل و در صورت تولید ADR، گزارش تست یا خلاصه مرحله، تمپلیت‌های `artefacts/templates/` استفاده شوند.

### 5. بازیابی در صورت شکست
- در صورت خرابی محیط، شکست Migration، فساد کانفیگ یا هر رفتار غیرمنتظره، بلافاصله فعالیت‌ها متوقف و سند `docs/environment_recovery_guide.md` دنبال شود.
- پس از بازیابی موفق، اقدامات انجام‌شده، علت و نتیجه در فرم پایان مرحله و بخش Assumptions ثبت گردد.
- اگر نیاز به بازگشت به نسخه سالم وجود دارد، مطابق `docs/change_control_and_revert.md` عمل و اقدام انجام‌شده را مستند کن.
- در تحویل نهایی پروژه، فرم `artefacts/final_delivery_checklist.md` باید تکمیل و در کنار Artefactهای مرحله 25 بایگانی شود.

### 6. فرهنگ کیفیت
- **شفافیت کامل:** مشکلات، ریسک‌ها و انحراف‌ها باید به‌محض کشف ثبت شوند؛ پنهان‌کاری یا تعویق گزارش خط قرمز است.
- **مسئولیت مشترک:** هر ایجنت مسئول کیفیت جهانی محصول است؛ اگر کاستی دیدی، فارغ از مالک مرحله، آن را گزارش کن.
- **یادگیری و بازنگری:** در پایان هر مرحله Lessons Learned کوتاه یادداشت کن (موفقیت‌ها، کاستی‌ها، پیشنهاد بهبود).

### 7. ممنوعیت‌ها
- اجرای مرحله بدون مطالعه مجدد Playbook و `marahel.txt`.
- افزودن قابلیت یا تغییر دامنه بدون ثبت و تأیید.
- استناد به فرضیات حل‌نشده یا Artefactهای غیرمستند.
- اتکا به Docker یا محیط‌های مغایر با سیاست Native (Windows).

### 8. یادآوری نهایی
- اگر خروجی یا تستی سندیت ندارد، گویی انجام نشده است.
- اگر فرضی ثبت نشده، وجود خارجی ندارد.
- اگر Playbook و `marahel.txt` به‌روزرسانی می‌شوند، نسخهٔ جدید باید در ابتدای مرحله بعد مطالعه و تأیید شود.

> در هر لحظه، معیار ما این است: «آیا می‌توانیم همین حالا پروژه را به یک تیم مستقل تحویل دهیم و مطمئن باشیم بدون سؤال اضافی یا خطای پنهان ادامه می‌دهند؟» اگر پاسخ «نه» است، مرحله هنوز تمام نشده است.
